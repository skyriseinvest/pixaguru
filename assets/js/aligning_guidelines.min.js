function initAligningGuidelines(c){ "use strict"; var m=c.getSelectionContext(),b=0,a=1,i=1,l="rgba(0,255,0,0.5)",f;function g(n){j(n.x+0.5,n.y1>n.y2?n.y2:n.y1,n.x+0.5,n.y2>n.y1?n.y2:n.y1)}function d(n){j(n.x1>n.x2?n.x2:n.x1,n.y+0.5,n.x2>n.x1?n.x2:n.x1,n.y+0.5)}function j(o,q,n,p){m.save();m.lineWidth=i;m.strokeStyle=l;m.beginPath();m.moveTo(o*f[0],q*f[3]);m.lineTo(n*f[0],p*f[3]);m.stroke();m.restore()}function e(p,o){p=Math.round(p);o=Math.round(o);for(var q=p-a,n=p+a;q<=n;q++){if(q===o){return true}}return false}var k=[],h=[];c.on("mouse:down",function(){f=c.viewportTransform});c.on("object:moving",function(w){var o=w.target,t=c.getObjects(),z=o.getCenterPoint(),v=z.x,C=z.y,x=o.getBoundingRectHeight()/f[3],A=o.getBoundingRectWidth()/f[0],s=false,D=false,q=c._currentTransform;if(!q){return}for(var u=t.length;u--;){if(t[u]===o){continue}var r=t[u].getCenterPoint(),y=r.x,B=r.y,n=t[u].getBoundingRectHeight()/f[3],p=t[u].getBoundingRectWidth()/f[0];if(e(y,v)){D=true;k.push({x:y,y1:(B<C)?(B-n/2-b):(B+n/2+b),y2:(C>B)?(C+x/2+b):(C-x/2-b)});o.setPositionByOrigin(new fabric.Point(y,C),"center","center")}if(e(y-p/2,v-A/2)){D=true;k.push({x:y-p/2,y1:(B<C)?(B-n/2-b):(B+n/2+b),y2:(C>B)?(C+x/2+b):(C-x/2-b)});o.setPositionByOrigin(new fabric.Point(y-p/2+A/2,C),"center","center")}if(e(y+p/2,v+A/2)){D=true;k.push({x:y+p/2,y1:(B<C)?(B-n/2-b):(B+n/2+b),y2:(C>B)?(C+x/2+b):(C-x/2-b)});o.setPositionByOrigin(new fabric.Point(y+p/2-A/2,C),"center","center")}if(e(B,C)){s=true;h.push({y:B,x1:(y<v)?(y-p/2-b):(y+p/2+b),x2:(v>y)?(v+A/2+b):(v-A/2-b)});o.setPositionByOrigin(new fabric.Point(v,B),"center","center")}if(e(B-n/2,C-x/2)){s=true;h.push({y:B-n/2,x1:(y<v)?(y-p/2-b):(y+p/2+b),x2:(v>y)?(v+A/2+b):(v-A/2-b)});o.setPositionByOrigin(new fabric.Point(v,B-n/2+x/2),"center","center")}if(e(B+n/2,C+x/2)){s=true;h.push({y:B+n/2,x1:(y<v)?(y-p/2-b):(y+p/2+b),x2:(v>y)?(v+A/2+b):(v-A/2-b)});o.setPositionByOrigin(new fabric.Point(v,B+n/2-x/2),"center","center")}}if(!s){h.length=0}if(!D){k.length=0}});c.on("before:render",function(){c.clearContext(c.contextTop)});c.on("after:render",function(){for(var n=k.length;n--;){g(k[n])}for(var n=h.length;n--;){d(h[n])}k.length=h.length=0});c.on("mouse:up",function(){k.length=h.length=0;c.renderAll()})};